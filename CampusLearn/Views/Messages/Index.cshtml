@model CampusLearn.Models.MessageView
@{
    ViewData["Title"] = "Messages";
}

<div class="ai-chat">
    <!-- Contact Selector -->
    <aside class="ai-chat__sidebar">
        <h3>Contacts</h3>
        <ul class="contact-list">
            @foreach (var user in Model.AllUsers.GroupBy(u => u.Groups.FirstOrDefault()))
            {
                <li class="contact-group">@user.Key</li>
                foreach (var contact in user)
                {
                    var isActive = contact.Username == Model.SelectedRecipient ? "active" : "";
                    <li class="contact-item @isActive">
                        <a asp-action="Index" asp-route-recipient="@contact.Username">@contact.FullName</a>
                    </li>
                }
            }
        </ul>
    </aside>

    <!-- Message Display Area -->
    <div class="ai-chat__messages">
        @foreach (var msg in Model.Messages)
        {
            var alignmentClass = msg.IsUser ? "ai-msg--user" : "ai-msg--ai";
            <div class="ai-msg @alignmentClass">
                <div class="ai-msg__bubble">@msg.Content</div>
                <div class="ai-msg__meta">@msg.SenderName • @msg.Timestamp.ToString("HH:mm dd MMM")</div>
            </div>
        }
    </div>

    <!-- Message Composer -->
    <form asp-action="SendMessage" method="post" class="ai-chat__composer">
        <input type="hidden" name="recipient" value="@Model.SelectedRecipient" />
        <div class="input-group">
            <input type="text" name="messageText" class="form-control ai-chat__input" placeholder="Type your message..." required />
            <button type="submit" class="ai-chat__send">Send</button>
        </div>
    </form>
</div>