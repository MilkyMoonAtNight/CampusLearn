@model CampusLearn.Models.MessageView
@{
    ViewData["Title"] = "User Directory";
    var isStudentView = ViewData["IsStudentView"] as bool? ?? true;
}

<div class="directory-wrapper">
    <header class="directory-header">
        <h2>@ViewData["Title"]</h2>
        <button id="toggleView" class="btn btn-secondary">
            Show @(isStudentView ? "Tutors" : "Students")
        </button>
    </header>

    <section class="directory-controls">
        <input type="text" id="searchInput" class="form-control" placeholder="Search by name or email..." />
        <button id="sortButton" class="btn btn-outline-primary">Sort A–Z</button>
    </section>

    <section class="directory-table">
        <div class="table-responsive">
            <table class="table table-hover align-middle">
                <thead class="table-light">
                    <tr>
                        <th>Name</th>
                        <th>Surname</th>
                        <th>ID</th>
                        <th>Email</th>
                        <th>Phone</th>
                        <th>Groups</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody id="userTable">
                    @foreach (var user in Model.AllUsers)
                    {
                        <tr>
                            <td>@user.FirstName</td>
                            <td>@user.LastName</td>
                            <td>@user.Id</td>
                            <td>@(user.Email ?? "-")</td>
                            <td>@(user.PhoneNumber ?? "-")</td>
                            <td>@string.Join(", ", user.Groups ?? new List<string>())</td>
                            <td>
                                <a class="btn btn-sm btn-success"
                                   asp-controller="Messages"
                                   asp-action="ChatWith"
                                   asp-route-id="@user.Id">
                                    💬 Message
                                </a>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </section>
</div>

@section Scripts {
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const toggleBtn = document.getElementById("toggleView");
            const searchInput = document.getElementById("searchInput");
            const sortBtn = document.getElementById("sortButton");
            const userTable = document.getElementById("userTable");

            if (toggleBtn) {
                toggleBtn.addEventListener("click", () => {
                    // Optional future feature if you add a SwitchView endpoint
                    window.location.href = "/Messages/SwitchView";
                });
            }

            if (searchInput && userTable) {
                searchInput.addEventListener("input", function () {
                    const q = this.value.toLowerCase();
                    const rows = userTable.querySelectorAll("tr");
                    rows.forEach(row => {
                        row.style.display = row.innerText.toLowerCase().includes(q) ? "" : "none";
                    });
                });
            }

            if (sortBtn && userTable) {
                sortBtn.addEventListener("click", function () {
                    const rows = Array.from(userTable.rows);
                    rows.sort((a, b) => a.cells[0].innerText.localeCompare(b.cells[0].innerText));
                    rows.forEach(row => userTable.appendChild(row));
                });
            }
        });
    </script>
}

<style>
    .directory-wrapper {
        padding: 30px;
        max-width: 1200px;
        margin: auto;
        background-color: #fff;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0,0,0,0.05);
        font-family: "Segoe UI", sans-serif;
    }

    .directory-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }

    .directory-controls {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
    }

    #searchInput {
        flex-grow: 1;
        padding: 8px;
        border-radius: 5px;
        border: 1px solid #ccc;
    }

    .directory-table {
        overflow-x: auto;
    }

    .table-hover tbody tr:hover {
        background-color: #f0f8ff;
        cursor: pointer;
    }

    thead th {
        position: sticky;
        top: 0;
        background-color: #f8f9fa;
        z-index: 1;
    }
</style>
