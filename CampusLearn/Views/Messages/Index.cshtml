@model CampusLearn.Models.MessageView
@{
    ViewData["Title"] = "User Directory";
    var isStudentView = ViewData["IsStudentView"] as bool? ?? true;
}

<script>
    document.getElementById("toggleView").addEventListener("click", function () {
        // Call backend or reload with ViewData["IsStudentView"] toggled
        window.location.href = "/Messages/SwitchView"; // example endpoint
    });

    document.getElementById("searchInput").addEventListener("input", function () {
        const query = this.value.toLowerCase();
        const rows = document.querySelectorAll("#userTable tr");
        rows.forEach(row => {
            row.style.display = row.innerText.toLowerCase().includes(query) ? "" : "none";
        });
    });

    document.getElementById("sortButton").addEventListener("click", function () {
        const table = document.getElementById("userTable");
        const rows = Array.from(table.rows);
        rows.sort((a, b) => a.cells[0].innerText.localeCompare(b.cells[0].innerText));
        rows.forEach(row => table.appendChild(row));
    });

    function startChat(userId) {
        window.location.href = `/Messages/ChatWith/${userId}`;
    }
</script>

<div class="directory-wrapper">
    <header class="directory-header">
        <h2>@ViewData["Title"]</h2>
        <button id="toggleView" class="btn btn-secondary">
            Show @(isStudentView ? "Tutors" : "Students")
        </button>
    </header>

    <section class="directory-controls">
        <input type="text" id="searchInput" class="form-control" placeholder="Search by name or email..." />
        <button id="sortButton" class="btn btn-outline-primary">Sort A-Z</button>
    </section>

    <section class="directory-table">
        <div class="table-responsive">
            <table class="table table-hover align-middle">
                <thead class="table-light">
                    <tr>
                        <th>Name</th>
                        <th>Surname</th>
                        <th>ID</th>
                        <th>Email</th>
                        <th>Phone</th>
                        <th>Groups</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody id="userTable">
                    @foreach (var user in Model.AllUsers)
                    {
                        <tr>
                            <td>@user.FirstName</td>
                            <td>@user.LastName</td>
                            <td>@user.ID</td>
                            <td>@user.Email</td>
                            <td>@user.PhoneNumber</td>
                            <td>@string.Join(", ", Model.Groups ?? new List<string>())</td>
                            <td>
                                <button class="btn btn-sm btn-success" onclick="startChat('@user.ID')">💬 Message</button>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </section>
</div>

<style>
    .directory-wrapper {
        padding: 30px;
        max-width: 1200px;
        margin: auto;
        background-color: #fff;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0,0,0,0.05);
    }

    .directory-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }

    .directory-controls {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
    }

    #searchInput {
        flex-grow: 1;
        padding: 8px;
        border-radius: 5px;
        border: 1px solid #ccc;
    }

    .directory-table {
        overflow-x: auto;
    }

    .table-hover tbody tr:hover {
        background-color: #f0f8ff;
        cursor: pointer;
    }

    thead th {
        position: sticky;
        top: 0;
        background-color: #f8f9fa;
        z-index: 1;
    }

</style>